<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FPL Price Tracker</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: #f9f9f9;
      color: #333;
    }

    header {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 15px;
      background-color: #333;
    }

    header a {
      color: #fff;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: background-color 0.2s;
    }

    header a:hover {
      background-color: #555;
    }

    header a.active {
      background-color: #007BFF;
    }

    main {
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      color: #222;
    }

    #lastUpdate {
      text-align: center;
      color: #555;
      font-style: italic;
      margin-bottom: 20px;
    }

    /* ðŸ”Ž SÃ¶kfÃ¤lt */
    #playerSearch {
      padding: 8px;
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin: 0 auto 30px auto;
      display: block;
      text-align: center;
    }

    .date-block {
      margin-bottom: 50px;
    }

    .date-block h2 {
      color: #222;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    h3 {
      margin-top: 20px;
      margin-bottom: 10px;
      color: #444;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
      background-color: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    th, td {
      border-bottom: 1px solid #eee;
      padding: 10px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    th {
      font-weight: 600;
    }

    tbody tr:nth-child(odd) {
      background-color: #fafafa;
    }

    tbody tr:nth-child(even) {
      background-color: #fff;
    }

    tr:hover {
      background-color: #f5f5f5;
    }

    thead.price-up th {
      background-color: #d4edda;
      color: #155724;
    }

    thead.price-down th {
      background-color: #f8d7da;
      color: #721c24;
    }

    th:nth-child(1), td:nth-child(1) { width: 40%; }
    th:nth-child(2), td:nth-child(2) { width: 30%; }
    th:nth-child(3), td:nth-child(3) { width: 20%; }
    th:nth-child(4), td:nth-child(4) { width: 20%; }
  </style>
</head>
<body>
  <header>
    <a href="/">Start</a>
    <a href="/changes" class="active">Changes</a>
    <a href="/predictions">Predictions</a>
  </header>

  <main>
    <h1>FPL Price change history</h1>
    <p id="lastUpdate">Loading updates...</p>

    <!-- ðŸ”Ž SÃ¶kfÃ¤lt -->
    <input type="text" id="playerSearch" placeholder="Search player..."/>

    <div id="content"></div>
  </main>

 <script>
  async function loadChanges() {
    const res = await fetch("/api/changes", { cache: "no-store" });
    const data = await res.json();

    const content = document.getElementById("content");
    content.innerHTML = "";

    const days = Array.isArray(data.days) ? data.days : [];
    if (days.length === 0) {
      document.getElementById("lastUpdate").innerText = "No updates found";
      return;
    }

    document.getElementById("lastUpdate").innerText =
  "Last update: " + days[0].date.replace("_no_changes", "");

    function renderTable(title, rows, type) {
      if (!rows || rows.length === 0) {
        return `<p style="text-align:center; color:#777; font-style:italic;">No ${title.toLowerCase()} this day</p>`;
      }

      return `
        <h3>${title}</h3>
        <table>
          <thead class="${type === "up" ? "price-up" : "price-down"}">
            <tr>
              <th>Player</th>
              <th>Team</th>
              <th>New</th>
              <th>Old</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => {
              const team = r.team;
              const logoPath = `/static/logos/${team}.png`;
              return `
                <tr>
                  <td class="player-cell">
                    <div style="display:flex; flex-direction:column; align-items:center; gap:4px;">
                      <img src="${logoPath}" alt="${team} logo" style="height:30px;" onerror="this.style.display='none'">
                      <span>${r.web_name}</span>
                    </div>
                  </td>
                  <td>${team}</td>
                  <td>${r.new_price}</td>
                  <td>${r.price_prev}</td>
                </tr>
              `;
            }).join("")}
          </tbody>
        </table>
      `;
    }

    for (const day of days) {
  const cleanDate = day.date.replace("_no_changes", "");  // ta bort suffix

  const block = document.createElement("div");
  block.className = "date-block";
  block.innerHTML = `
    <h2>${cleanDate}</h2>
    ${renderTable("Risers", day.up, "up")}
    ${renderTable("Fallers", day.down, "down")}
  `;
  content.appendChild(block);
}

    // ðŸ”Ž Live-sÃ¶k
    const searchInput = document.getElementById("playerSearch");
    searchInput.addEventListener("input", function() {
      const filter = this.value.toLowerCase();
      document.querySelectorAll("#content table tbody tr").forEach(row => {
        const playerCell = row.querySelector(".player-cell span");
        if (playerCell && playerCell.textContent.toLowerCase().includes(filter)) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    });
  }

  loadChanges();
</script>

</body>
</html>
